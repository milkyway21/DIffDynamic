# è¿è¡Œé¡¹ç›®æ‰€éœ€æ¸…å•æ€»ç»“

æ ¹æ®ç¯å¢ƒæ£€æŸ¥ç»“æœï¼Œä»¥ä¸‹æ˜¯æ‚¨éœ€è¦å‡†å¤‡çš„å†…å®¹ï¼š

## âœ… å·²å…·å¤‡

1. **Pythonç¯å¢ƒ**ï¼šPython 3.13.5ï¼ˆå»ºè®®ä½¿ç”¨3.8-3.10ï¼Œä½†3.13ä¹Ÿå¯ä»¥å°è¯•ï¼‰
2. **å·²å®‰è£…çš„åŒ…**ï¼š
   - âœ… torch
   - âœ… torch_geometric
   - âœ… rdkit
   - âœ… numpy
   - âœ… yaml
   - âœ… lmdb
3. **é…ç½®æ–‡ä»¶**ï¼š
   - âœ… configs/training.yml
   - âœ… configs/sampling.yml
4. **ç¤ºä¾‹æ–‡ä»¶**ï¼š
   - âœ… examples/1h36_A_rec_1h36_r88_lig_tt_docked_0_pocket10.pdb

## âŒ éœ€è¦å‡†å¤‡

### 1. å®‰è£…ç¼ºå¤±çš„PythonåŒ…

```bash
# å®‰è£… openbabel
conda install openbabel -c conda-forge
# æˆ–è€…
pip install openbabel
```

### 2. ä¸‹è½½å¿…éœ€çš„æ•°æ®æ–‡ä»¶

**æ•°æ®åˆ’åˆ†æ–‡ä»¶**ï¼ˆå¿…éœ€ï¼‰ï¼š
- æ–‡ä»¶åï¼š`crossdocked_pocket10_pose_split.pt`
- ä¸‹è½½åœ°å€ï¼šhttps://drive.google.com/drive/folders/1j21cc7-97TedKh_El5E34yI8o5ckI7eK?usp=share_link
- ä¿å­˜ä½ç½®ï¼š`./data/crossdocked_pocket10_pose_split.pt`

### 3. ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹

**é¢„è®­ç»ƒæ‰©æ•£æ¨¡å‹**ï¼ˆå¿…éœ€ï¼Œç”¨äºé‡‡æ ·ï¼‰ï¼š
- æ–‡ä»¶åï¼š`pretrained_diffusion.pt`
- ä¸‹è½½åœ°å€ï¼šhttps://drive.google.com/drive/folders/1-ftaIrTXjWFhw3-0Twkrs5m0yX6CNarz?usp=share_link
- ä¿å­˜ä½ç½®ï¼š`./pretrained_models/pretrained_diffusion.pt`

### 4. ï¼ˆå¯é€‰ï¼‰è®­ç»ƒæ•°æ®

å¦‚æœæ‚¨æƒ³ä»å¤´è®­ç»ƒæ¨¡å‹ï¼Œè¿˜éœ€è¦ï¼š
- è®­ç»ƒæ•°æ®ï¼š`crossdocked_v1.1_rmsd1.0_pocket10_processed_final.lmdb`
- ä¸‹è½½åœ°å€ï¼šåŒä¸Šæ•°æ®æ–‡ä»¶å¤¹
- ä¿å­˜ä½ç½®ï¼š`./data/` ç›®å½•ä¸‹

## ğŸš€ å¿«é€Ÿå¼€å§‹æ­¥éª¤

### æ­¥éª¤1ï¼šå®‰è£…ç¼ºå¤±çš„åŒ…
```bash
conda install openbabel -c conda-forge
```

### æ­¥éª¤2ï¼šä¸‹è½½å¿…éœ€æ–‡ä»¶
1. ä»Google Driveä¸‹è½½ `crossdocked_pocket10_pose_split.pt` åˆ° `data/` ç›®å½•
2. ä»Google Driveä¸‹è½½ `pretrained_diffusion.pt` åˆ° `pretrained_models/` ç›®å½•

### æ­¥éª¤3ï¼šéªŒè¯ç¯å¢ƒ
```bash
python check_requirements.py
```

åº”è¯¥çœ‹åˆ°æ‰€æœ‰å¿…éœ€é¡¹éƒ½æ˜¾ç¤º `[OK]`

### æ­¥éª¤4ï¼šå¼€å§‹ä½¿ç”¨

#### é€‰é¡¹Aï¼šä½¿ç”¨ç¤ºä¾‹æ–‡ä»¶å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èï¼‰
```bash
python scripts/sample_for_pocket.py configs/sampling.yml \
  --pdb_path examples/1h36_A_rec_1h36_r88_lig_tt_docked_0_pocket10.pdb \
  --device cuda:0 \
  --num_samples 32 \
  --result_path ./outputs/test_sample
```

**æ³¨æ„**ï¼šéœ€è¦GPUï¼ˆCUDAï¼‰ï¼Œå¦‚æœæ²¡æœ‰GPUå¯ä»¥ä½¿ç”¨ `--device cpu`ï¼ˆä¼šå¾ˆæ…¢ï¼‰

#### é€‰é¡¹Bï¼šä»æµ‹è¯•é›†é‡‡æ ·
```bash
python scripts/sample_diffusion.py configs/sampling.yml \
  --data_id 0 \
  --device cuda:0 \
  --result_path ./outputs/test_case0
```

## ğŸ“ æ–‡ä»¶ç»“æ„æ£€æŸ¥æ¸…å•

è¿è¡Œé¡¹ç›®å‰ï¼Œç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨ï¼š

```
DiffDynamic/
â”œâ”€â”€ pretrained_models/
â”‚   â””â”€â”€ pretrained_diffusion.pt          â† éœ€è¦ä¸‹è½½
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ crossdocked_pocket10_pose_split.pt â† éœ€è¦ä¸‹è½½
â”‚   â””â”€â”€ affinity_info.pkl                 âœ… å·²æœ‰
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ training.yml                       âœ… å·²æœ‰
â”‚   â””â”€â”€ sampling.yml                       âœ… å·²æœ‰
â””â”€â”€ examples/
    â””â”€â”€ 1h36_A_rec_1h36_r88_lig_tt_docked_0_pocket10.pdb  âœ… å·²æœ‰
```

## âš ï¸ é‡è¦æç¤º

1. **Pythonç‰ˆæœ¬**ï¼šæ‚¨å½“å‰ä½¿ç”¨çš„æ˜¯Python 3.13.5ï¼Œé¡¹ç›®æ¨è3.8-3.10ã€‚å¦‚æœé‡åˆ°å…¼å®¹æ€§é—®é¢˜ï¼Œå»ºè®®åˆ›å»ºæ–°çš„condaç¯å¢ƒï¼š
   ```bash
   conda create -n targetdiff python=3.8
   conda activate targetdiff
   # ç„¶åé‡æ–°å®‰è£…æ‰€æœ‰ä¾èµ–
   ```

2. **GPUè¦æ±‚**ï¼šé¡¹ç›®éœ€è¦CUDAæ”¯æŒçš„GPUã€‚æ£€æŸ¥GPUï¼š
   ```bash
   python -c "import torch; print(f'CUDAå¯ç”¨: {torch.cuda.is_available()}')"
   ```

3. **æ˜¾å­˜è¦æ±‚**ï¼šå»ºè®®è‡³å°‘8GBæ˜¾å­˜ã€‚å¦‚æœæ˜¾å­˜ä¸è¶³ï¼Œå¯ä»¥ï¼š
   - å‡å° `configs/sampling.yml` ä¸­çš„ `sample.dynamic.large_step.batch_size`
   - å‡å° `configs/sampling.yml` ä¸­çš„ `sample.dynamic.refine.n_sampling`

## ğŸ“š æ›´å¤šå¸®åŠ©

- è¯¦ç»†å‡†å¤‡æ¸…å•ï¼š`è¿è¡Œå‡†å¤‡æ¸…å•.md`
- å¿«é€Ÿå¼€å§‹æŒ‡å—ï¼š`å¿«é€Ÿå¼€å§‹.md`
- æ¨¡å‹ä½¿ç”¨æŒ‡å—ï¼š`MODEL_USAGE_GUIDE.md`

## ğŸ”„ ä¸‹ä¸€æ­¥

1. âœ… è¿è¡Œ `python check_requirements.py` æ£€æŸ¥ç¯å¢ƒ
2. â¬œ å®‰è£… openbabel
3. â¬œ ä¸‹è½½æ•°æ®åˆ’åˆ†æ–‡ä»¶
4. â¬œ ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹
5. â¬œ å†æ¬¡è¿è¡Œæ£€æŸ¥è„šæœ¬ç¡®è®¤
6. â¬œ å¼€å§‹ä½¿ç”¨é¡¹ç›®ï¼

